# ISO 9000 HTML パース仕様

## 概要

このドキュメントでは、ISO 9000語彙HTMLファイル（Q9000-2025-01-vocabulary-flat.html）を解析してJSON形式に変換する際のパース仕様を定める。

## HTMLの構造

HTMLファイルは以下の構造を持つ：

- `<p>` タグで各行が囲まれている
- 各行には異なる種類の情報が含まれる（カテゴリID、カテゴリタイトル、用語ID、用語名、説明文、注記、例、備考）

## パース仕様

### 1. カテゴリの識別

- **パターン**: `<p>3.x</p>` （"3.x"のみが記載された行）
- **説明**: "3.1", "3.2"などの番号のみが書かれた`<p>`タグは、新しいカテゴリの開始を示す
- **次の行**: カテゴリIDの次の`<p>`タグにはカテゴリのタイトルが含まれる
- **データ構造**: カテゴリは`id`（"3.x"）と`name`（カテゴリタイトル）のプロパティを持つ

### 2. 用語IDの識別

- **パターン**: `<p>3.x.y</p>` （"3.x.y"のようなピリオド区切りの3つの番号）
- **説明**: 個別の用語の識別子
- **次の行**: 用語IDの次の`<p>`タグには用語名が含まれる

### 3. 用語の構成要素

#### 用語名

- 用語IDの直後の`<p>`タグに含まれる
- 日本語用語と英語用語（括弧内）が含まれる場合がある
- 例: `トップマネジメント（top management）`

#### 説明文

- 用語名の次の`<p>`タグから開始
- 複数行にまたがる可能性がある
- 以下のいずれかまで続く：
  - 次の用語ID（"3.x.y"形式）
  - "注記"で始まる行
  - "例"で始まる行
  - 備考行（"（...）"または"［...］"で完全に囲まれた行）

#### 注記

- **パターン**: "注記"で始まる行
- **種類**: "注記1", "注記2"のように番号付きの場合がある
- **配列として管理**: 複数の注記は別々の要素として配列に格納
- **複数行対応**: 次の用語ID、"例", "注記", 備考行まで続く

#### 例

- **パターン**: "例"で始まる行
- **処理**: 注記と同様の方法でパース
- **配列として管理**: 複数の例がある場合は配列に格納

#### 備考

- **パターン**: "（"で始まり"）"で終わる行、または"［"で始まり"］"で終わる行
- **条件**: 行全体が括弧または角括弧で完全に囲まれていること
- **除外**: "（3.4.5）を含むことがある。"のような部分的な括弧は備考ではない
- **処理**: 必ず1行で完結し、用語に対して一つのみ存在
- **データ型**: 配列ではなく単一の文字列として管理
- **用途**: 追加情報や参照情報

## 出力JSON構造

```json
{
  "metadata": {
    "title": "文書タイトル",
    "extractedAt": "ISO日時文字列",
    "totalTerms": 数値,
    "totalCategories": 数値
  },
  "categories": {
    "カテゴリ名": {
      "id": "3.x",
      "name": "カテゴリ名",
      "terms": [
        {
          "id": "3.x.y",
          "term": "用語名",
          "englishTerm": "英語用語（任意）",
          "definition": "説明文",
          "notes": ["注記配列"],
          "examples": ["例配列"],
          "remark": "備考文字列（任意）"
        }
      ]
    }
  }
}
```

## パース処理の流れ

1. HTMLを行単位（`<p>`タグ単位）で分割し、各行をtrim処理
2. カテゴリID（"3.x"）を検出し、カテゴリ開始点を特定
3. 各カテゴリ内で用語ID（"3.x.y"）を検出
4. 各用語について、用語名、説明文、注記、例、備考を順次抽出
5. 抽出したデータをJSON構造に変換して出力

## 行処理の注意点

- **重要**: 全ての行は前後の空白を除去（trim）して処理
- パース時に行のテキストは必ずtrimしてから使用
- 空白が値として混入しないように注意
- カテゴリID、カテゴリ名、用語ID、用語名、説明文、注記、例、備考の全てでtrim処理を適用

## エラーハンドリング

- 予期しない形式の行が見つかった場合はログに記録
- 必須フィールド（ID、用語名、説明文）が欠如している場合はその用語をスキップ
- パース処理は可能な限り継続し、最終的に取得できたデータを出力
